---
title: Pipeline Overview
---

# Pipeline Overview

HEDGEHOG implements a sequential molecular filtering pipeline that progressively narrows a large set of generated molecules down to high-quality drug candidates. Each stage applies domain-specific filters, and only molecules that pass all enabled stages reach the final output.

## Pipeline Stages

| # | Stage | Purpose | Typical Retention |
|---|-------|---------|-------------------|
| 1 | Mol Prep (Datamol) | Standardize molecules and remove salts/fragments/charges/stereochemistry; canonicalize tautomers | 70--95% |
| 2 | Molecular Descriptors | Compute 22 physicochemical descriptors and filter by threshold ranges | 40--80% |
| 3 | Structural Filters | Apply medicinal chemistry alerts, complexity checks, and structural rules | 50--90% |
| 4 | Synthesis Analysis | Evaluate synthetic accessibility (SA Score, SYBA, RA Score) and retrosynthesis feasibility | 30--70% |
| 5 | Molecular Docking | Dock surviving molecules into the target protein binding site | ~100% (scoring, not filtering) |
| 6 | Docking Filters | Filter docked poses by search-box containment, clashes, interactions, and conformer deviation | 20--70% |
| 7' | Final Descriptors | Recompute descriptors on the final molecule set for reporting | 100% (no filtering) |

Retention rates are approximate and depend heavily on the input molecule set and configuration thresholds.

## Data Flow

```
input/sampled_molecules.csv
        |
        v
 [Stage 1: Mol Prep]
        |
        v
 [Stage 2: Descriptors]
        |  filtered_molecules.csv
        v
 [Stage 3: Structural Filters]
        |  filtered_molecules.csv
        v
 [Stage 4: Synthesis Analysis]
        |  filtered_molecules.csv
        v
 [Stage 5: Molecular Docking]
        |  gnina_out.sdf / smina_out.sdf
        v
 [Stage 6: Docking Filters]
        |  filtered_molecules.csv
        v
 [Stage 7': Final Descriptors]
        |
        v
 output/final_molecules.csv
```

Every stage reads `filtered_molecules.csv` from the previous stage and writes its own `filtered_molecules.csv`. This convention enables the pipeline to resume from any intermediate point.

## Sequential Filtering Approach

The pipeline is designed as a funnel: cheap, fast filters run first (descriptors, structural alerts), and expensive operations (docking, retrosynthesis) run later on a smaller molecule set. This ordering minimizes computational cost while maximizing coverage.

Key design decisions:

- **Early exit**: if a stage produces zero passing molecules, the pipeline terminates early rather than running subsequent stages on an empty set.
- **Single-stage mode**: any stage can be run independently with `--stage <name>`, which is useful for debugging or re-running a single step.
- **Provenance**: all configuration files are snapshotted into a `configs/` directory at the start of each run, and a `RUN_INFO.md` is generated at completion.

## Stage Configuration

Each stage has its own YAML configuration file referenced from the master `config.yml`:

```yaml
config_mol_prep: src/hedgehog/configs/config_mol_prep.yml
config_descriptors: src/hedgehog/configs/config_descriptors.yml
config_structFilters: src/hedgehog/configs/config_structFilters.yml
config_synthesis: src/hedgehog/configs/config_synthesis.yml
config_docking: src/hedgehog/configs/config_docking.yml
config_docking_filters: src/hedgehog/configs/config_docking_filters.yml
```

Every stage config includes a `run: true/false` flag that controls whether it executes. See the [Configuration Reference](/configuration/reference) for full details.

## Output Structure

Each pipeline run creates a timestamped results directory with the following layout:

```
results/run_N/
+-- input/
|   +-- sampled_molecules.csv
+-- stages/
|   +-- 00_mol_prep/
|   +-- 01_descriptors_initial/
|   +-- 03_structural_filters_post/
|   +-- 04_synthesis/
|   +-- 05_docking/
|   +-- 06_docking_filters/
|   +-- 07_descriptors_final/
+-- output/
|   +-- final_molecules.csv
+-- configs/
|   +-- master_config_resolved.yml
|   +-- config_*.yml
+-- report.html
+-- report_data.json
+-- RUN_INFO.md
+-- run_YYYYMMDD_HHMMSS.log
```

`output/final_molecules.csv` is the canonical final artifact. It preserves all columns from the latest filtered dataset and includes aggregated docking score columns (`gnina_affinity`, `gnina_cnnscore`, `gnina_cnnaffinity`, `gnina_cnn_vs`, `smina_affinity`) when docking outputs are available.
