# Docking Filters Configuration
# Filters applied to docking poses to select high-quality candidates

run: true
run_after_docking: true  # Run automatically after docking stage

# Input/output settings
input_sdf: null  # If null, uses docking output (smina_out.sdf or gnina_out.sdf)
receptor_pdb: null  # If null, uses receptor from docking config

# Filter 0: Search Box (Fast)
# Ensures the final docked pose is inside the configured docking search box.
# The box is resolved from docking config (center/size) or autobox_ligand + autobox_add.
search_box:
  enabled: true
  max_outside_fraction: 0.0  # 0.0 = all atoms must be inside the box
  short_circuit: true  # When aggregation.mode == "all", skip heavy filters for failed poses

# Filter 1: Pose Quality (PoseCheck)
# Checks for steric clashes and ligand strain
pose_quality:
  enabled: true
  max_clashes: 2  # Maximum allowed steric clashes (0 = strict)
  max_strain_energy: 50.0  # Maximum ligand strain energy in kcal/mol (relaxed from 10.0; typical: 4-10)
  strain_forcefield: "UFF"  # UFF, MMFF94s, or MMFF94s_noEstat
  clash_tolerance: 0.5  # Angstrom tolerance for VdW overlap detection

# Filter 2: Interactions (ProLIF)
# Checks for required protein-ligand interactions
interactions:
  enabled: true
  reference_ligand: null  # Path to reference SDF for similarity comparison
  min_hbonds: 0  # Minimum H-bonds required (0 = no requirement)
  required_residues: []  # e.g., ["ASP:123", "SER:45"] - must have interaction
  forbidden_residues: []  # e.g., ["CYS:200"] - must NOT have interaction
  interaction_types:  # Which types to check
    - HBDonor
    - HBAcceptor
    - Hydrophobic
    - VdWContact
  similarity_threshold: 0.0  # Tanimoto to reference (0 = disabled)
  # Note: FaceToFace interaction excluded due to edge cases causing errors

# Filter 3: Shepherd-Score (3D Similarity)
# Compares molecular shape to reference ligand
shepherd_score:
  enabled: false  # Requires reference ligand
  reference_ligand: null  # Required: path to reference SDF
  min_shape_score: 0.5  # Minimum Gaussian overlap Tanimoto
  alpha: 0.81  # Gaussian width parameter (default from paper)
  align_before_scoring: true  # Align molecules before scoring

# Filter 4: Conformer Deviation
# Checks if docked pose is geometrically plausible
conformer_deviation:
  enabled: true
  num_conformers: 50  # Number of conformers to generate
  conformer_method: "ETKDGv3"  # ETKDG, ETKDGv2, ETKDGv3
  max_rmsd_to_conformer: 3.0  # Angstrom - reject if pose is too different
  random_seed: 42  # For reproducibility
  optimize_conformers: false  # UFF optimization (slow, often fails)

# Aggregation settings
aggregation:
  mode: "all"  # "all" = pass all filters, "any" = pass at least one
  save_metrics: true  # Save detailed metrics CSV
  save_failed: false  # Save molecules that failed filtering
